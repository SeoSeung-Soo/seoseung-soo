{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>{% block title %}SeoSeung-Soo{% endblock %}</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
    <link rel="stylesheet" href="{% static 'css/chats/chat.css' %}">
    {% block style %}
    {% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="container header-bar">
            <div class="left-actions">
                <button class="menu-toggle" aria-label="Toggle menu">
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                    <span class="hamburger-line"></span>
                </button>
            </div>
            <a href="/" class="logo">SeoSeung-Soo</a>
            <nav class="top-nav">
                {% if user.is_authenticated and user.role == 'admin' %}
                <a href="{% url 'product-list' %}">ADMIN</a>
                {% endif %}
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">LOGIN</a>
                {% endif %}
                {% if user.is_authenticated %}
                <a href="/users/logout/">LOGOUT</a>
                {% endif %}
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">MYPAGE</a>
                {% elif user.is_authenticated %}
                <a href="/users/mypage/">MYPAGE</a>
                {% endif %}
            </nav>
        </div>
        <div class="container main-nav">
            <nav class="category-nav">
                {% for main_category in main_categories %}
                <a href="#" data-category="category-{{ main_category.id }}">{{ main_category.name|upper }}</a>
                {% endfor %}
                <a href="#">BEST ITEM</a>
                <a href="#">EVENT</a>
                <a href="#">FAQ</a>
                <a href="{% url 'inquire' %}">INQUIRE</a>
            </nav>
            <div class="search-box">
                <input type="text" placeholder="검색어를 입력하세요" class="search-input">
                <button class="search-btn" aria-label="검색"></button>
            </div>
        </div>
        
{#        <div class="desktop-sub-categories">#}
{#            {% for main_category in main_categories %}#}
{#            <div class="desktop-sub-category-section" data-parent="category-{{ main_category.id }}">#}
{#                <nav class="desktop-sub-category-nav">#}
{#                    {% for sub_category in main_category.children.all %}#}
{#                    <a href="#">{{ sub_category.name }}</a>#}
{#                    {% empty %}#}
{#                    <span class="no-subcategory">소분류가 없습니다</span>#}
{#                    {% endfor %}#}
{#                </nav>#}
{#            </div>#}
{#            {% endfor %}#}
{#        </div>#}
        
        <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
        
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <h3>MENU</h3>
                <button class="mobile-menu-close" id="mobileMenuClose" aria-label="메뉴 닫기">×</button>
            </div>
            <nav class="mobile-main-category">
                {% for main_category in main_categories %}
                <a href="#" data-category="category-{{ main_category.id }}">{{ main_category.name|upper }}</a>
                {% endfor %}
            </nav>
            
            <div class="mobile-sub-categories">
                {% for main_category in main_categories %}
                <div class="sub-category-section" data-parent="category-{{ main_category.id }}">
                    <nav class="sub-category-nav">
                        {% for sub_category in main_category.children.all %}
                        <a href="#">{{ sub_category.name }}</a>
                        {% empty %}
                        <a href="#" class="no-subcategory">소분류가 없습니다</a>
                        {% endfor %}
                    </nav>
                </div>
                {% endfor %}
            </div>
            
           
            <div class="mobile-search-box">
                <input type="text" placeholder="검색어를 입력하세요" class="mobile-search-input">
                <button class="mobile-search-btn" aria-label="검색"></button>
            </div>
            <nav class="mobile-user-nav">
                {% if user.is_authenticated and user.role == 'admin' %}
                <a href="{% url 'product-list' %}">ADMIN</a>
                {% endif %}
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">LOGIN</a>
                {% endif %}
                {% if user.is_authenticated %}
                <a href={% url "logout" %}>LOGOUT</a>
                {% endif %}                
                {% if not user.is_authenticated %}
                <a href="{% url "login" %}">MYPAGE</a>
                {% elif user.is_authenticated %}
                <a href={% url "mypage" %}>MYPAGE</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <main class="container">
        {% block content %}
        {% endblock %}
    </main>
    <div class="floating-chat">
        <div class="chat-button" id="chatButton">
            <div class="chat-icon">S</div>
            <div class="chat-text">CHAT</div>
        </div>
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-window-header">
            <h3 class="chat-window-title logo">SeoSeung-Soo</h3>
            <button class="chat-close-btn" id="chatCloseBtn">×</button>
        </div>
        <div class="chat-window-body">
            <div class="chat-news-feed">
                <div class="news-feed-header">
                    <h3>NEW PRODUCTS</h3>
                    <div class="news-feed-nav desktop-only">
                        <button class="news-feed-nav-btn news-feed-prev" id="newsFeedPrev">‹</button>
                        <button class="news-feed-nav-btn news-feed-next" id="newsFeedNext">›</button>
                    </div>
                </div>
                <div class="news-feed-container">
                    <div class="news-feed-grid" id="newsFeedGrid">
                        {% for product in new_products %}
                        <a href="{% url 'products-detail' product.name %}" class="news-feed-item">
                            {% if product.image.first %}
                                <img src="{{ product.image.first.image.url }}" alt="{{ product.name }}">
                            {% else %}
                                <div class="news-feed-placeholder">No Image</div>
                            {% endif %}
                            <div class="news-feed-overlay">
                                <span class="news-feed-name">{{ product.name|truncatechars:15 }}</span>
                            </div>
                        </a>
                        {% empty %}
                        <div class="no-new-products">
                            <p>새로운 상품이 없습니다.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="chat-action-buttons">
                <a href="{% url 'inquire' %}" class="chat-action-btn">
                    <span>문의하기</span>
                    <span class="arrow">→</span>
                </a>
                <a href="#" class="chat-action-btn" onclick="alert('자주 묻는 질문 기능은 준비중입니다.')">
                    <span>자주 묻는 질문</span>
                    <span class="arrow">→</span>
                </a>
            </div>
        </div>
    </div>

     <div id="toast-container" class="toast-container"></div>
    <footer class="site-footer">
        <div class="container">
            <p style="text-align: left">CEO : 정수지</p>
            <p style="text-align: center">© SeoSeung-Soo. All rights reserved.</p>

        </div>
    </footer>

    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/prevent-drag.js' %}"></script>
    <script src="{% static 'js/toast.js' %}"></script>
    <script src="{% static 'js/chats/chat.js' %}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>